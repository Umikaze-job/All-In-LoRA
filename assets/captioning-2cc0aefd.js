import{d as C,b as D,m as k,A as N,g as l,_ as B,r as n,o as g,c as p,e as r,w as d,F as u,f as v,t as h,h as o,i as T,k as F,l as A,x as $,j as R}from"./index-f554547e.js";import{T as M}from"./template01-ba756e31.js";import{r as U}from"./row-Buttons02-bd54fb00.js";import{I as E,D as V}from"./ImageItemComp-fc9404f4.js";import{m as q}from"./mini-Button01-ed5526ec.js";import{a as s,t as _}from"./tag_name-6410ff4f.js";const L=C({setup(){const{selecting_id:e,ImageDataSet:a,ImageFolderID:t,selectingImageDataSet:c,ImageFolderRowButtonClick:f}=E();return{selecting_id:e,ImageDataSet:a,ImageFolderID:t,selectingImageDataSet:c,ImageFolderRowButtonClick:f}},components:{"base-tem":M,"row-button":U,"image-item":V,"mini-button":q,"modal-window":D,"modal-base":k},data(){return{store:N(),isModal:!1,canBackgroundCancel:!1}},methods:{captionUpdate(){let e=this.selectingImageDataSet[this.selecting_id[0]].tags;this.selectingImageDataSet[this.selecting_id[0]].caption==""||this.selectingImageDataSet[this.selecting_id[0]].caption==null?e.findIndex(t=>t.tagname==s.captionAlready.name)!=-1&&(e=e.filter(t=>t.tagname!=s.captionAlready.name),this.selectingImageDataSet[this.selecting_id[0]].tags=e):e.findIndex(t=>t.tagname==s.captionAlready.name)==-1&&(e.push({tagname:s.captionAlready.name,tagcolor:s.captionAlready.color}),this.selectingImageDataSet[this.selecting_id[0]].tags=e)},ImageItemClick(e){this.selecting_id=[e]},async startCaption(){this.store.setTransState(1),this.isModal=!0;const e=await this.axios.post(l()+"/api/make-textfile/captioning/start-caption",{folderName:this.store.getSelectingFolderName,captionImage:{folderId:this.ImageFolderID,ImageName:this.selectingImageDataSet[this.selecting_id[0]].file_name}});this.selectingImageDataSet[this.selecting_id[0]].caption=e.data.caption,this.captionUpdate(),this.isModal=!1,this.store.setTransState(0)},async setImagesTags(){const e=await this.axios.post(l()+"/api/make-textfile/tagging/alreadytag",{folderName:this.store.getSelectingFolderName}),a=await this.axios.post(l()+"/api/make-textfile/captioning/captiontag",{folderName:this.store.getSelectingFolderName});this.ImageDataSet.base.forEach((t,c)=>{t.tags=[],e.data.base_images.includes(t.file_name)&&t.tags.push({tagname:s.alreadyTag.name,tagcolor:s.alreadyTag.color}),a.data.base_images.includes(t.file_name)&&t.tags.push({tagname:s.captionAlready.name,tagcolor:s.captionAlready.color}),_(t.tags)}),this.ImageDataSet.after.forEach((t,c)=>{t.tags=[],e.data.after_images.includes(t.file_name)&&t.tags.push({tagname:s.alreadyTag.name,tagcolor:s.alreadyTag.color}),a.data.after_images.includes(t.file_name)&&t.tags.push({tagname:s.captionAlready.name,tagcolor:s.captionAlready.color}),_(t.tags)})}},async unmounted(){await this.axios.post(l()+"/api/make-textfile/captioning/write",{folderName:this.store.getSelectingFolderName,baseImages:this.ImageDataSet.base,afterImages:this.ImageDataSet.after})},computed:{nowSelectImagePath(){return this.selecting_id[0]!=-1?this.selectingImageDataSet[this.selecting_id[0]].image_url:""},nowSelectImageCaption(){return this.selecting_id[0]!=-1?this.selectingImageDataSet[this.selecting_id[0]].caption:""}},async created(){const e=await this.axios.post(l()+"/api/make-textfile/captioning/start",{folderName:this.store.getSelectingFolderName});this.ImageDataSet.base=[],e.data.base.forEach((a,t)=>{this.ImageDataSet.base.push({image_url:a.path,thumbnail_path:a.thumbnail_path,file_name:a.path.split("\\").slice(-1)[0],caption:a.caption,tags:[]})}),this.ImageDataSet.after=[],e.data.after.forEach((a,t)=>{this.ImageDataSet.after.push({image_url:a.path,thumbnail_path:a.thumbnail_path,file_name:a.path.split("\\").slice(-1)[0],caption:a.caption,tags:[]})}),await this.setImagesTags()}}),P=o("div",{class:"flex flex-row text-center text-lg text-white font-Raleway"},null,-1),j={class:"flex flex-row gap-2"},z={class:"basis-3/5 flex flex-col gap-2"},H={class:"flex flex-row justify-start"},W={class:"border-winBorder border-white rounded-md min-h-[50px] max-h-[600px] grid grid-cols-4 gap-2 overflow-y-auto p-3 text-white font-Raleway"},G={class:"basis-2/5 border-winBorder border-white rounded-lg flex flex-col gap-6 p-2"},J=["src"],K={class:"flex flex-col gap-1"},O={class:"text-white font-Raleway"},Q=o("select",{class:"text-white font-Raleway bg-NormalButtonColor rounded-md"},[o("option",null,"model01"),o("option",null,"model02")],-1),X={class:"flex flex-row justify-start text-white font-Raleway"},Y={class:"flex flex-col gap-2"},Z={class:"text-white font-Raleway"},ee={class:"border-winBorder border-white rounded-md min-h-[200px] bg-NormalButtonColor"},te=o("p",{class:"text-center text-xl underline decoration-myUnderLine01 py-8"},"Loading...",-1);function ae(e,a,t,c,f,oe){const w=n("row-button"),I=n("image-item"),b=n("mini-button"),x=n("base-tem"),S=n("modal-window"),y=n("modal-base");return g(),p(u,null,[r(x,null,{maintitle:d(()=>[v(h(e.$t("topbar.MakeTextFile.Captioning")),1)]),buttonContents:d(()=>[P]),mainContents:d(()=>[o("div",j,[o("div",z,[o("div",H,[r(w,{onClickItem:e.ImageFolderRowButtonClick,nowId:e.ImageFolderID,subItems:[e.$t("Caption.rowButton.base"),e.$t("Caption.rowButton.after")]},null,8,["onClickItem","nowId","subItems"])]),o("div",W,[(g(!0),p(u,null,T(e.selectingImageDataSet,(i,m)=>(g(),F(I,{key:m,"tag-data":i.tags,id:m,selectedId:e.selecting_id,onClick:se=>e.ImageItemClick(m),imagePath:i.thumbnail_path,"file-name":i.file_name},null,8,["tag-data","id","selectedId","onClick","imagePath","file-name"]))),128))])]),o("div",G,[o("img",{src:e.nowSelectImagePath,class:"h-full mx-auto"},null,8,J),o("div",K,[o("p",O,h(e.$t("Caption.modelName")),1),Q]),o("div",X,[r(b,{enable:e.selecting_id[0]!=-1,buttonName:e.$t("Caption.captioning"),buttonColorHover:"bg-ApplyColor",onClickItem:e.startCaption},null,8,["enable","buttonName","onClickItem"])]),o("div",Y,[o("p",Z,h(e.$t("Caption.captionText")),1),o("div",ee,[e.selecting_id[0]!=-1?A((g(),p("textarea",{key:0,class:"py-3 px-3 bg-transparent text-white font-Raleway border-none outline-none focus:ring-transparent resize-none whitespace-break-spaces w-full h-full rounded-lg",onInput:a[0]||(a[0]=(...i)=>e.captionUpdate&&e.captionUpdate(...i)),"onUpdate:modelValue":a[1]||(a[1]=i=>e.selectingImageDataSet[e.selecting_id[0]].caption=i)},null,544)),[[$,e.selectingImageDataSet[e.selecting_id[0]].caption]]):R("",!0)])])])])]),_:1}),r(y,{"is-window":e.isModal,"can-background-cancel":e.canBackgroundCancel},{default:d(()=>[r(S,null,{default:d(()=>[te]),_:1})]),_:1},8,["is-window","can-background-cancel"])],64)}const ge=B(L,[["render",ae]]);export{ge as default};
