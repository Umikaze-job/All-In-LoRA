import{d as F,u as N,m as B,b as V,A as $,g as d,_ as L,r as g,o as w,c as k,e as l,w as p,F as C,f as E,t as M,h as m,i as A,k as R,j as W}from"./index-f554547e.js";import{T as U}from"./template01-ba756e31.js";import{r as j}from"./row-Buttons02-bd54fb00.js";import{I as q,D as z}from"./ImageItemComp-fc9404f4.js";import{m as G}from"./mini-Button01-ed5526ec.js";import{m as H}from"./mini-Button02-f87e8570.js";import{a as s,t as h}from"./tag_name-6410ff4f.js";import{m as J}from"./modal-LoadingBar01-b5a3ea64.js";import{m as K}from"./ModalItemComp-d2246648.js";import{t as O}from"./textbox-form01-6d8e04eb.js";import{s as P}from"./slider-form01-86189dd3.js";const Q=F({setup(){const{selecting_id:e,isMultipleSelect:a,ImageDataSet:t,ImageFolderID:r,selectImageItemID:u,selectingImageDataSet:o,clickAllItems:n,getFileNameFromUrl:I,setAlready_CaptionTag:c,ImageFolderRowButtonClick:b}=q(),{isModal:_,canModalCancel:T,canControl:D}=K(),{triggerWord:S,ExcludeTags:x,threshold:y,character_threshold:i,set_Tagging_Data_To_Store:f,get_Tagging_Data_To_Store:v}=N();return{selecting_id:e,isMultipleSelect:a,ImageDataSet:t,ImageFolderID:r,selectImageItemID:u,selectingImageDataSet:o,clickAllItems:n,getFileNameFromUrl:I,setAlready_CaptionTag:c,isModal:_,canModalCancel:T,canControl:D,ImageFolderRowButtonClick:b,triggerWord:S,ExcludeTags:x,threshold:y,character_threshold:i,set_Tagging_Data_To_Store:f,get_Tagging_Data_To_Store:v}},components:{"base-tem":U,"row-button":j,"image-item":z,"mini-button":G,"mini-button02":H,"modal-base":B,"modal-window":V,"modal-load":J,"textbox-form01":O,"slider-form01":P},data(){return{store:$(),LoadingValue:{max:0,value:0}}},created(){this.getImageList(),this.ImageFolderID=0,this.get_Tagging_Data_To_Store()},unmounted(){this.set_Tagging_Data_To_Store()},methods:{readyForTagging(){this.selecting_id.forEach(e=>{if(this.ImageFolderID==0){this.ImageDataSet.base[e].tags.find(t=>t.tagname==s.readyTag.name)||this.ImageDataSet.base[e].tags.push({tagname:s.readyTag.name,tagcolor:s.readyTag.color});let a=this.ImageDataSet.base[e].tags;a=a.filter(t=>t.tagname!=s.deleteTag.name),h(a),this.ImageDataSet.base[e].tags=a}else{this.ImageDataSet.after[e].tags.find(t=>t.tagname==s.readyTag.name)||this.ImageDataSet.after[e].tags.push({tagname:s.readyTag.name,tagcolor:s.readyTag.color});let a=this.ImageDataSet.after[e].tags;a=a.filter(t=>t.tagname!=s.deleteTag.name),h(a),this.ImageDataSet.after[e].tags=a}})},notReadyForTagging(){this.selecting_id.forEach(e=>{if(this.ImageFolderID==0){let a=this.ImageDataSet.base[e].tags;a=a.filter(t=>t.tagname!=s.readyTag.name&&t.tagname!=s.deleteTag.name),this.ImageDataSet.base[e].tags=a,h(this.ImageDataSet.base[e].tags)}else{let a=this.ImageDataSet.after[e].tags;a=a.filter(t=>t.tagname!=s.readyTag.name&&t.tagname!=s.deleteTag.name),this.ImageDataSet.after[e].tags=a,h(this.ImageDataSet.after[e].tags)}})},readyForDelete(){this.selecting_id.forEach(e=>{if(this.ImageFolderID==0){this.ImageDataSet.base[e].tags.find(t=>t.tagname==s.deleteTag.name)||this.ImageDataSet.base[e].tags.push({tagname:s.deleteTag.name,tagcolor:s.deleteTag.color});let a=this.ImageDataSet.base[e].tags;a=a.filter(t=>t.tagname!=s.readyTag.name),h(a),this.ImageDataSet.base[e].tags=a}else{this.ImageDataSet.after[e].tags.find(t=>t.tagname==s.deleteTag.name)||this.ImageDataSet.after[e].tags.push({tagname:s.deleteTag.name,tagcolor:s.deleteTag.color});let a=this.ImageDataSet.after[e].tags;a=a.filter(t=>t.tagname!=s.readyTag.name),h(a),this.ImageDataSet.after[e].tags=a}})},async getImageList(){const e=await this.axios.post(d()+"/api/processing-images/input-images",{folderName:this.store.getSelectingFolderName});this.ImageDataSet.base=[],e.data.data_paths.forEach((t,r)=>{this.ImageDataSet.base.push({image_url:t,thumbnail_path:e.data.thumbnail_path[r],file_name:this.getFileNameFromUrl(t),tags:[]})});const a=await this.axios.post(d()+"/api/processing-images/output-input-images",{folderName:this.store.getSelectingFolderName});this.ImageDataSet.after=[],a.data.data_paths.forEach((t,r)=>{this.ImageDataSet.after.push({image_url:t,thumbnail_path:a.data.thumbnail_path[r],file_name:this.getFileNameFromUrl(t),tags:[]})}),await this.setAlready_CaptionTag(this)},async startTagging(){const e=this.ImageDataSet.base.filter(o=>o.tags.find(n=>n.tagname==s.readyTag.name)).map(o=>o.image_url.split("\\").slice(-1)[0]),a=this.ImageDataSet.after.filter(o=>o.tags.find(n=>n.tagname==s.readyTag.name)).map(o=>o.image_url.split("\\").slice(-1)[0]),t=this.ImageDataSet.base.filter(o=>o.tags.find(n=>n.tagname==s.deleteTag.name)).map(o=>o.image_url.split("\\").slice(-1)[0]),r=this.ImageDataSet.after.filter(o=>o.tags.find(n=>n.tagname==s.deleteTag.name)).map(o=>o.image_url.split("\\").slice(-1)[0]);this.canControl(!1),this.isModal=!0,this.LoadingValue.max=e.length+a.length+t.length+r.length,this.LoadingValue.value=0;const u={triggerWord:this.triggerWord,ExcludeTags:this.ExcludeTags,threshold:this.threshold,character_threshold:this.character_threshold};for(const o of e)await this.axios.post(d()+"/api/make-textfile/tagging/write",{folderName:this.store.getSelectingFolderName,fileName:o,type:"base",lotaData:u}),this.LoadingValue.value+=1;for(const o of a)await this.axios.post(d()+"/api/make-textfile/tagging/write",{folderName:this.store.getSelectingFolderName,fileName:o,type:"after",lotaData:u}),this.LoadingValue.value+=1;for(const o of t)await this.axios.post(d()+"/api/make-textfile/tagging/write",{folderName:this.store.getSelectingFolderName,fileName:o,type:"deleteBase",lotaData:u}),this.LoadingValue.value+=1;for(const o of r)await this.axios.post(d()+"/api/make-textfile/tagging/write",{folderName:this.store.getSelectingFolderName,fileName:o,type:"deleteAfter",lotaData:u}),this.LoadingValue.value+=1;await this.setAlready_CaptionTag(this),await this.axios.post(d()+"/api/make-textfile/tagging/set-trigger-word",{folderName:this.store.getSelectingFolderName,triggerWord:this.triggerWord}),await this.axios.post(d()+"/api/make-textfile/tagging/clear_tagging_model"),this.canControl(!0),this.isModal=!1}}}),X=m("div",{class:"flex flex-row text-center text-lg text-white font-Raleway"},null,-1),Y={class:"flex flex-row border-winBorder border-white rounded-lg p-3"},Z={class:"basis-3/4 flex flex-col gap-2"},ee={class:"border-winBorder border-white w-full max-h-[600px] rounded-lg overflow-y-auto grid grid-cols-5 gap-2 p-3 text-white font-Raleway"},ae={class:"basis-1/4 flex flex-col gap-6 mt-3"},te={class:"flex flex-col gap-6 max-h-[580px] overflow-y-auto"},oe={class:"flex flex-col justify-center w-full px-3 gap-2"},se={class:"flex flex-col gap-2 text-white font-Raleway text-base text-center"},le={key:0,class:"flex flex-col gap-2"},ie=m("p",{class:"text-center text-xl underline decoration-myUnderLine01 py-8"},"Loading...",-1);function ne(e,a,t,r,u,o){const n=g("row-button"),I=g("image-item"),c=g("mini-button"),b=g("textbox-form01"),_=g("slider-form01"),T=g("mini-button02"),D=g("base-tem"),S=g("modal-load"),x=g("modal-window"),y=g("modal-base");return w(),k(C,null,[l(D,null,{maintitle:p(()=>[E(M(e.$t("topbar.MakeTextFile.Tagging")),1)]),buttonContents:p(()=>[X]),mainContents:p(()=>[m("div",Y,[m("div",Z,[l(n,{nowId:e.ImageFolderID,subItems:[e.$t("Tagging.rowButton.base"),e.$t("Tagging.rowButton.after")],onClickItem:e.ImageFolderRowButtonClick},null,8,["nowId","subItems","onClickItem"]),m("div",ee,[(w(!0),k(C,null,A(e.selectingImageDataSet,(i,f)=>(w(),R(I,{key:f,onClick:v=>e.selectImageItemID(f),id:f,"selected-id":e.selecting_id,"tag-data":i.tags,"image-path":i.thumbnail_path,"file-name":i.file_name},null,8,["onClick","id","selected-id","tag-data","image-path","file-name"]))),128))])]),m("div",ae,[l(c,{"button-name":e.$t("Tagging.StartTagging"),"button-color-hover":"bg-ApplyColor","add-class":"text-white font-Raleway text-xl text-center w-[70%] mx-auto",onClick:e.startTagging},null,8,["button-name","onClick"]),m("div",te,[m("div",oe,[l(b,{"form-name":e.$t("Tagging.form.TriggerWord"),"model-value":e.triggerWord,"onUpdate:modelValue":a[0]||(a[0]=i=>e.triggerWord=i)},null,8,["form-name","model-value"]),l(b,{"form-name":e.$t("Tagging.form.excludeTags"),"model-value":e.ExcludeTags,"onUpdate:modelValue":a[1]||(a[1]=i=>e.ExcludeTags=i)},null,8,["form-name","model-value"]),l(_,{"form-name":"threshold",min:0,max:1,step:.01,"model-value":e.threshold,"onUpdate:modelValue":a[2]||(a[2]=i=>e.threshold=i)},null,8,["model-value"]),l(_,{"form-name":"character_threshold",min:0,max:1,step:.01,"model-value":e.character_threshold,"onUpdate:modelValue":a[3]||(a[3]=i=>e.character_threshold=i)},null,8,["model-value"])]),m("div",se,[l(T,{"button-name":e.$t("Tagging.miniButton.MultipleSelect"),"add-class":"w-[90%] mx-auto","is-clicked":e.isMultipleSelect,onClick:a[4]||(a[4]=i=>e.isMultipleSelect=!e.isMultipleSelect)},null,8,["button-name","is-clicked"]),l(c,{"button-name":e.$t("Tagging.miniButton.AllSelect"),"add-class":"w-[70%] mx-auto",onClick:e.clickAllItems},null,8,["button-name","onClick"])]),e.selecting_id[0]!=-1&&e.selecting_id.length!=0?(w(),k("div",le,[l(c,{"button-name":e.$t("Tagging.miniButton.CreateTags"),"add-class":"text-white font-Raleway text-base text-center w-[70%] mx-auto",onClick:e.readyForTagging},null,8,["button-name","onClick"]),l(c,{"button-name":e.$t("Tagging.miniButton.DeleteTags"),"add-class":"text-white font-Raleway text-base text-center w-[70%] mx-auto",onClick:e.readyForDelete},null,8,["button-name","onClick"]),l(c,{"button-name":e.$t("Tagging.miniButton.Cancel"),"add-class":"text-white font-Raleway text-base text-center w-[70%] mx-auto",onClick:e.notReadyForTagging},null,8,["button-name","onClick"])])):W("",!0)])])])]),_:1}),l(y,{"is-window":e.isModal,"can-background-cancel":e.canModalCancel},{default:p(()=>[l(x,null,{default:p(()=>[ie,l(S,{"value-max":e.LoadingValue.max,"now-value":e.LoadingValue.value},null,8,["value-max","now-value"])]),_:1})]),_:1},8,["is-window","can-background-cancel"])],64)}const we=L(Q,[["render",ne]]);export{we as default};
